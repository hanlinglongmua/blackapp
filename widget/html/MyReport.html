<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>我的发表</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <style>
          body,html{
            width: 100%;height: 100%;margin: 0;padding: 0;
              background-color: #f1f1f1;
          }
          ul li{
            list-style-type: none;
          }
          /*top 顶部样式*/
          .collection{
            width: 100%;
            height: 44px;
            position: fixed;
            z-index: 999;
          }
          .collection .top{
            width: 100%;
            height: 70px;
            background: url('../images/same_content/Header.jpg');
          }
          .collection .top .sect{
            float: left;
            width: 33.33%;
            height: 100%;
          }
          .collection .top .fo{
            font-size: 18px;
            color: #fff;
            line-height: 86px;
            text-align: center;
          }
          .collection .top .right{
            font-size: 14px;
            color: #fff;
            line-height: 86px;
            text-align: right;
          }
          .collection .top .right .edit{
            margin-right: 10px;
          }
          .collection .top .left>i{
            position: absolute;
            left: 15px;
            top:36px;
            width: 12px;
            height: 12px;
            border: 1px solid #fff;
            border-top: none;
            border-right: none;
            transform:rotate(45deg);
            -webkit-transform:rotate(45deg);
          }
          /*top end*/

          /*main (文章)内容页面*/

          .main{
            width: 100%;
            height: 100%;
            padding-top: 44px;
            background-color: #f2f2f2;
          }
          .main .article{
            padding: 8px 8px 0 8px;
            height: 66px;
            background-color: #fff;
            display: flex;
            align-items: center;
            margin-bottom: 4px;
          }
          .main .article img{
            height: 60px;
            width: 98px;
          }
          .main .article .text{
            width: 100%;
            height: 100%;
            padding: 0 6px 0 6px;
            position: relative;
          }
          .main .article input{
            width: 60px;
            color: red;
            display: none;
          }
          .main .article .title
          {
            font-size: 16px;
            color: #111;
            line-height: 22px;
            overflow:hidden;
            text-overflow:ellipsis;
            display:-webkit-box;
            -webkit-line-clamp:2;
            -webkit-box-orient:vertical;
          }
          .main .article .foot{
            font-size: 10px;
            color: #5d5d5d;
          }
          .main .article .foot .date{
            position: absolute;
            bottom: 4px;
          }
          .main .article .foot .read{
            position: absolute;
            bottom: 4px;
            right: 0;
          }
          /*main (文章)内容页面 end*/
          /*有视频的文章*/
          .main{
            width: 100%;
            height: 100%;
            padding-top: 80px;
            background-color: #f2f2f2;
          }
          .main .video{
            padding: 8px 8px 0 8px;
            height: 66px;
            background-color: #fff;
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            position: relative;
          }
          .main .video img{
            height: 60px;
          }
          .main .video .image .playimg{
            position: absolute;
            height: 45px;
            top: 22%;
            left: 35px;
          }
          .main .video .text{
            width: 100%;
            height: 100%;
            padding: 0 6px 0 6px;
            position: relative;
          }
          .main .video .title
          {
            font-size: 16px;
            color: #111;
            line-height: 22px;
            overflow:hidden;
            text-overflow:ellipsis;
            display:-webkit-box;
            -webkit-line-clamp:2;
            -webkit-box-orient:vertical;
          }
          .main .video .foot{
            font-size: 10px;
            color: #5d5d5d;
          }
          .main .video .foot .date{
            position: absolute;
            bottom: 4px;
          }
          .main .video .foot .read{
            position: absolute;
            bottom: 4px;
            right: 0;
          }
          /*有视频的文章end*/
          footer{
            position: fixed;
            bottom: 0;
            height: 44px;
            width: 100%;
            background-color: #fff;
            display: none;
          }
          footer div{
            float: left;
            line-height: 44px;
            width: 50%;
            text-align: center;
          }
          footer .allCheck{
            position: relative;
          }
          footer span{
            position: absolute;
            right: 0;
            top: 11px;
            border-right: 1px solid #f1f1f1;
            height: 22px;
          }
          footer .delbtn{

          }
      </style>
  </head>
  <body>
    <div class="mycollection">
      <!-- top 顶部 -->
      <div class="collection">
        <div class="top">
          <div class="sect left"><i onclick="api.closeWin()"></i></div>
          <div class="sect fo">我的发表</div>
          <div class="sect right"><div class="edit" id="edit" onclick="delReport()">编辑</div></div>
        </div>
      </div>
      <!-- top end -->

      <!-- main内容页面 -->
      <div class="main current" id="main">
          <!-- 有图片的文章 -->
          <div class="article">
              <div class="image"><img src="../images/MyReport/report1.png" alt=""></div>
              <div class="text">
                <div class="title t">真·海景房，早上鲨鱼来叫醒你</div>
                <div class="foot t">
                    <div class="date">2018/03/20</div>
                    <div class="read">2018阅读</div>
                </div>
              </div>
              <input type="checkbox" name="" value="">
          </div>

          <div class="article">
              <div class="image"><img src="../images/MyReport/report2.png" alt=""></div>
              <div class="text">
                <div class="title t">工作时，我们总少不了需要一些小工具的协助</div>
                <div class="foot t">
                    <div class="date">2018/03/20</div>
                    <div class="read">2018阅读</div>
                </div>
              </div>
          </div>

          <div class="article">
              <div class="image"><img src="../images/MyReport/report3.png" alt=""></div>
              <div class="text">
                <div class="title t">科技时代，连美甲都是智能</div>
                <div class="foot t">
                    <div class="date">2018/03/20</div>
                    <div class="read">2018阅读</div>
                </div>
              </div>
          </div>
          <!-- 有图片的文章 end -->

          <!-- 没有图片的文章 -->
          <div class="article">
            <div class="text" style="padding-left:0;">
              <div class="title t">人工智能时代来临人工智能时代来临人工智能时代来临人工智能时代来临</div>
              <div class="foot t">
                  <div class="date">2018/03/20</div>
                  <div class="read">2018阅读</div>
              </div>
            </div>
          </div>
          <!-- 没有图片的文章 end -->
          <!-- 有视频的文章 -->
          <div class="video">
              <div class="image">
                  <img src="../images/myreport/report4.png" alt="">
                  <img class="playimg" src="../images/myReport/play.png" alt="">
              </div>
              <div class="text">
                <div class="title t">真·海景房，早上鲨鱼来叫醒你</div>
                <div class="foot t">
                    <div class="date">2018/03/20</div>
                    <div class="read">2018阅读</div>
                </div>
              </div>
          </div>
          <!-- 有视频的文章end -->

      </div>
      <!-- main 内容页面 end -->
      <footer id="footer">
        <div class="allCheck" id="checkbo" onclick="allCheck()">全选<span></span></div>
        <div class="delbtn" onclick="delCheckBox()">删除</div>
      </footer>
    </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript">
      var userdata = {};
      userdata = $api.getStorage('userdata');
      //删除
      function delCheckBox() {
        api.confirm({
            title: '重要提示',
            msg: '确定删除吗',
            buttons: ['确定', '取消']
        }, function(ret, err){
            if( ret.buttonIndex == 1){
              var delName = document.getElementsByName('del[]');
              var arr = new Array();
              for(var j = 0;j<delName.length;j++){
                  if(delName[j].checked){
                    arr = arr+','+$api.val(delName[j]);
                  }
              }
              api.ajax({
                  url: 'http://www.lxzntech.com/deletePost.php',
                  method: 'post',
                  data: {
                      values: {
                          uid: userdata['uid'],tid:arr
                      }
                  }
              },function(ret, err){
                  if(ret.status == 1){
                    api.toast({
                        msg: '删除成功',
                        duration: 1000,
                        location: 'middle'
                    });
                    myReport();
                    delReport();
                  }else {
                    api.toast({
                        msg: '删除失败',
                        duration: 1000,
                        location: 'middle'
                    });
                  }
              });
            }else{
                return;
            }
        });
      }

      //编辑
      function delReport(){
        var footer = document.getElementById('footer');
        var editbtn = document.getElementsByClassName('del');
        for(var i = 0;i<editbtn.length;i++){
            if(editbtn[i].style.display === 'none'){
              editbtn[i].style.display = 'block';
              $api.text($api.byId('edit'), '取消');
              footer.style.display = 'block';
            }else{
              editbtn[i].style.display = 'none';
              $api.text($api.byId('edit'), '编辑');
              footer.style.display = 'none';
            }
        }
      }

      //全选
      function allCheck(){
        var delcheck = document.getElementsByName('del[]');
        for(var i=0;i<delcheck.length;i++){
            delcheck[i].checked=true;
        }
        document.getElementById('checkbo').removeAttribute('onclick');
        document.getElementById('checkbo').setAttribute('onclick','allNot()')
      }
      function allNot(){
        var delcheck = document.getElementsByName('del[]');
        for(var i=0;i<delcheck.length;i++){
            delcheck[i].checked=false;
        }
        document.getElementById('checkbo').removeAttribute('onclick');
        document.getElementById('checkbo').setAttribute('onclick','allCheck()')
      }

      apiready = function(){
          myReport();
      }

      function myReport(){
        var html = '';
        api.ajax({
            url: 'http://www.lxzntech.com/myCenter.php',
            method: 'post',
            data: {
                values: {
                    uid: userdata['uid']
                }
            }
        },function(ret, err){
            if (ret.status == 1) {
                var data = ret.data['sentData'];
                  for(var i=0;i<data.length;i++){
                    if(data[i]['idtype'] == 'aid'){
                      html+='<div class="article">';
                        html+='<div class="image" onclick="openArticalDetails('+data[i]['id']+')"><img src="http://www.lxzntech.com/data/attachment/'+data[i]['pic']+'" alt=""></div>';
                        html+='<div class="text" onclick="openArticalDetails('+data[i]['id']+')">';
                          html+='<div class="title t">'+data[i]['title']+'</div>';
                          html+='<div class="foot t">';
                            html+='<div class="date">'+data[i]['dateline']+'</div>';
                            html+='<div class="read">'+data[i]['views']+'&nbsp;阅读</div>';
                          html+='</div>';
                        html+='</div>';
                        html+='<input style="display:none;" type="checkbox" name="del" value="">';
                      html+='</div>';
                    }else if (data[i]['idtype'] == 'tid') {
                      html+='<div class="article">';
                        html+='<div class="text" onclick="openCommunityDetails('+data[i]['id']+')">';
                          html+='<div class="title t">'+data[i]['title']+'</div>';
                          html+='<div class="foot t">';
                            html+='<div class="date">'+data[i]['dateline']+'</div>';
                            html+='<div class="read">'+data[i]['views']+'阅读</div>';
                          html+='</div>';
                        html+='</div>';
                        html+='<input style="display:none;" class="del" type="checkbox" name="del[]" value="'+data[i]['id']+'">';
                      html+='</div>';
                    }
                  }
            } else {
                Toast( JSON.stringify( err ) );
            }
            $api.html($api.byId('main'), html);
        });

      }

      function openArticalDetails(id){
          api.openWin({
              name: 'ArticalDetails',
              url: 'ArticalDetails.html',
              pageParam: {
                  aid:id
              }
          });
      }

      function openCommunityDetails(id) {
          api.openWin({
              name: 'CommunityDetails',
              url: 'CommunityDetails.html',
              pageParam: {
                  tid: id
              }
          });

      }

      //自定义弹框
      function Toast(msg,duration){
          duration=isNaN(duration)?3000:duration;
          var m = document.createElement('div');
          m.innerHTML = msg;
          m.style.cssText="width: 60%;min-width: 150px;opacity: 0.7;height: 30px;color: rgb(255, 255, 255);line-height: 30px;text-align: center;border-radius: 5px;position: fixed;top: 50%;left: 20%;z-index: 999999;background: rgb(0, 0, 0);font-size: 12px;";
          document.body.appendChild(m);
          setTimeout(function() {
              var d = 0.5;
              m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
              m.style.opacity = '0';
              setTimeout(function() { document.body.removeChild(m) }, d * 1000);
          }, duration);
      }
  </script>
  </html>
